@startuml
' Định dạng giấy A4 portrait (210mm x 297mm)
skinparam pageSize 210 297
skinparam pageMargin 30
skinparam defaultFontSize 12

title Login Use Case - Sequence Diagram

actor User
participant "Frontend" as FE
participant "AuthController" as Controller
participant "AuthService" as Service
participant "UserRepository" as UserRepo
participant "UserTokenRepository" as TokenRepo
database "Database" as DB

== User Login ==
User -> FE : Nhập email, password
FE -> Controller : POST /auth/login { email, password }
Controller -> Service : login(dto)
Service -> UserRepo : findOne({ email })
UserRepo -> DB : Query user by email
DB --> UserRepo : User or null
UserRepo --> Service : User or null

alt User tồn tại
    Service -> Service : verify password
    alt Password đúng
        Service -> Service : generate access/refresh token
        Service -> TokenRepo : create REFRESH_TOKEN
        TokenRepo -> DB : Insert token
        DB --> TokenRepo : OK
        TokenRepo --> Service : Token
        Service --> Controller : { user, accessToken, refreshToken }
    else Password sai
        Service --> Controller : 401 Unauthorized
    end
else User không tồn tại
    Service --> Controller : 401 Unauthorized
end
Controller --> FE : 200 OK hoặc lỗi

@enduml
